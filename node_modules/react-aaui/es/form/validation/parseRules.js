import _toConsumableArray from 'babel-runtime/helpers/toConsumableArray';
import _slicedToArray from 'babel-runtime/helpers/slicedToArray';
import _defineProperty from 'babel-runtime/helpers/defineProperty';
import _extends from 'babel-runtime/helpers/extends';
import _Object$keys from 'babel-runtime/core-js/object/keys';
import Rules from './rules';

/*
 * `required|min:2|max:10` =>
 * [{"name":"required"},{"name":"min","param":"2"},{"name":"max","param":"10"}]
 */
var matchers = _Object$keys(Rules).reduce(function (r, rule) {
  return _extends({}, r, _defineProperty({}, rule, new RegExp(rule + '[^|]*')));
}, {});

matchers.regexp = /regexp:\(.*\)/;

var parseRules = function parseRules() {
  var rules = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  return _Object$keys(matchers).reduce(function (acc, key) {
    var rule = rules.match(matchers[key]);
    if (rule) {
      var _rule$0$split = rule[0].split(':'),
          _rule$0$split2 = _slicedToArray(_rule$0$split, 2),
          name = _rule$0$split2[0],
          param = _rule$0$split2[1];

      return param ? [].concat(_toConsumableArray(acc), [{ name: name, param: param }]) : [].concat(_toConsumableArray(acc), [{ name: name }]);
    }
    return acc;
  }, []);
};

export default parseRules;