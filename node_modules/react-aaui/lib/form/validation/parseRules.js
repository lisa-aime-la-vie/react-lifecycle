'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _extends3 = require('babel-runtime/helpers/extends');

var _extends4 = _interopRequireDefault(_extends3);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _rules = require('./rules');

var _rules2 = _interopRequireDefault(_rules);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * `required|min:2|max:10` =>
 * [{"name":"required"},{"name":"min","param":"2"},{"name":"max","param":"10"}]
 */
var matchers = (0, _keys2.default)(_rules2.default).reduce(function (r, rule) {
  return (0, _extends4.default)({}, r, (0, _defineProperty3.default)({}, rule, new RegExp(rule + '[^|]*')));
}, {});

matchers.regexp = /regexp:\(.*\)/;

var parseRules = function parseRules() {
  var rules = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
  return (0, _keys2.default)(matchers).reduce(function (acc, key) {
    var rule = rules.match(matchers[key]);
    if (rule) {
      var _rule$0$split = rule[0].split(':'),
          _rule$0$split2 = (0, _slicedToArray3.default)(_rule$0$split, 2),
          name = _rule$0$split2[0],
          param = _rule$0$split2[1];

      return param ? [].concat((0, _toConsumableArray3.default)(acc), [{ name: name, param: param }]) : [].concat((0, _toConsumableArray3.default)(acc), [{ name: name }]);
    }
    return acc;
  }, []);
};

exports.default = parseRules;